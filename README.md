
# CNChildBP: 中国儿童青少年血压评价工具包 🇨🇳🩺

<!-- badges: start -->

<!-- badges: end -->

**CNChildBP** (Chinese Child Blood Pressure) 是一个专为医学统计、流行病学研究及临床筛查设计的 R 语言工具包。

本工具包严格依据  **2017年《中国3～17岁儿童性别、年龄别和身高别血压参照标准》** ，实现了对儿童青少年血压数据的 **自动化清洗** 、**批量查表**及 **分级评价** 。它解决了传统手工查表效率低、易出错、且难以处理非标准化数据（如“3岁5月”）的痛点。

## 🌟 核心特性 (Key Features)

* **⚡️ 开箱即用 (Ready-to-Use)**
  * 内置完整的 2017 年国标数据，安装即用，无需用户手动整理或导入繁琐的查表数据。
* **🧠 智能解析 (Smart Parsing)**
  * 内置鲁棒的数据清洗算法，自动识别并处理混乱的年龄格式。
  * 支持格式：`10` (数值), `"10"` (字符), `"10岁"`, `"3岁5月"`, `"75月"` (纯月龄), `"10.5"` (小数岁)。
* **📏 严谨合规 (Strict Compliance)**
  * **身高处理** ：严格遵循国标要求的 **四舍五入** (`floor(x + 0.5)`) 取整查表，而非简单的去尾。
  * **年龄处理** ：严格遵循医学统计的 **周岁** (`floor(x)`) 查表。
  * **分级判定** ：精确执行 P90 / P95 / P99+5 界值，并包含  **120/80 mmHg 封顶原则** （即血压 ≥ 120/80 至少判定为正常高值）。

## 📦 安装指南 (Installation)

### 方式 1: 从 GitHub 在线安装 (推荐)

这是获取最新版本、享受 bug 修复的最佳方式。

```
# 如果未安装 devtools，请先运行:
# install.packages("devtools")

devtools::install_github("CalebChen941028/CNChildBP")

```

### 方式 2: 本地离线安装

如果您处于内网环境，或通过文件分享获得了安装包（`.tar.gz`）：

```
# 请修改为您本地文件的实际路径
install.packages("C:/Downloads/CNChildBP_0.1.0.tar.gz", repos = NULL, type = "source")

```

## 🚀 快速上手 (Quick Start)

### 批量评价示例

```
library(CNChildBP)
library(readxl)

# 1. 模拟一份包含不同格式的体检数据
df <- data.frame(
  姓名 = c("张三", "李四", "王五", "赵六"),
  性别 = c("男", "女", "男", "女"),
  # 演示智能解析：支持数值、"岁+月"、"纯月龄"、"小数"
  年龄 = c(10, "10岁5月", "125月", 6.9), 
  身高 = c(140.4, 142.6, 145, 118), # 注意：140.4->140, 142.6->143
  收缩压 = c(110, 118, 122, 100),
  舒张压 = c(70, 78, 82, 60)
)

# 2. 一键评价
result <- evaluate_bp(
  data = df, 
  sex_col = "性别",      # 指定您的性别列名
  age_col = "年龄",      # 指定您的年龄列名
  height_col = "身高",   # 指定您的身高列名
  sbp_col = "收缩压",    # 指定收缩压列名
  dbp_col = "舒张压"     # 指定舒张压列名
)

# 3. 查看结果
# 结果中会新增一列 `BP_Evaluation`
print(result)

# 4. 导出结果
# writexl::write_xlsx(result, "评价结果.xlsx")

```

## 📋 数据字典与格式说明

### 输入数据要求

`evaluate_bp()` 对输入数据的列名没有硬性要求（通过参数映射），但对**内容**有如下建议：

| **字段**   | **推荐列名** | **单位** | **数据类型** | **说明 / 智能容错**                             |
| ---------------- | ------------------ | -------------- | ------------------ | ----------------------------------------------------- |
| **性别**   | `性别`           | -              | 字符/因子          | 必须包含 "男" 或 "女" (或能转换的标识)                |
| **年龄**   | `年龄`           | 岁             | 数值/字符          | 支持 "3岁5月" (转为3.41岁)、"75月" (转为6.25岁)、"10" |
| **身高**   | `身高`           | cm             | 数值               | 自动执行**四舍五入**取整 (如 140.5 -> 141)      |
| **收缩压** | `收缩压`         | mmHg           | 数值               | 高压 (Systolic BP)                                    |
| **舒张压** | `舒张压`         | mmHg           | 数值               | 低压 (Diastolic BP)                                   |

### 输出结果含义

函数会在原数据框后追加一列 `BP_Evaluation`，其可能的值与含义如下：

| **评价结果**  | **英文标识** | **判定标准 (满足其一即可)**                      |
| ------------------- | ------------------ | ------------------------------------------------------ |
| **正常**      | Normal             | SBP < P90**且**DBP < P90                         |
| **正常高值**  | High-normal        | P90 ≤ BP < P95**或**BP ≥ 120/80 (且未达高血压) |
| **1期高血压** | Stage 1            | P95 ≤ BP < P99 + 5 mmHg                               |
| **2期高血压** | Stage 2            | BP ≥ P99 + 5 mmHg                                     |
| **无法评价**  | N/A                | 年龄不在 3-17 岁范围内，或身高超出极值                 |

## 🔬 医学逻辑细节 (Methodology)

本包的评价逻辑严格遵循范晖等人(2017)的文献及临床指南：

1. **正常高值判定 (High-normal Logic)**
   * 引入了  **120/80 mmHg 封顶规则** ：即如果儿童血压 $\ge 120/80$ mmHg，即使未达到同龄人 $P_{90}$，也判定为正常高值（除非已达到高血压标准）。这避免了体格高大的青少年血压超过成人高血压界值却被判定为“正常”的风险。
2. **综合评价规则**
   * **收缩压 (SBP)** 与 **舒张压 (DBP)** 独立评价。
   * 最终结果取两者中 **较严重** 的等级。例如：收缩压为“正常”，舒张压为“1期高血压”，则最终评价为“1期高血压”。
3. **计算精度**
   * **年龄** ：向下取整 (Floor)。例如 `10.9岁` 视为 `10岁组`。
   * **身高** ：四舍五入 (Round half up)。例如 `140.4cm` -> `140cm`，`140.5cm` -> `141cm`。

## 📚 参考文献 (Reference)

如果您的研究使用了本工具包，建议引用以下原始标准文献：

> **范晖, 闫银坤, 米杰. 中国3～17岁儿童性别、年龄别和身高别血压参照标准修订[J]. 中华高血压杂志, 2017, 25(5): 428-435. DOI: 10.16439/j.cnki.1673-7245.2017.05.009**

## 📄 许可证 (License)

MIT License. 欢迎学术界、医疗机构及公共卫生部门免费使用、修改和分发。

*由 [陈亮亮/Liangliang Chen] 维护开发*
